;   _._ ›; o|- -|o This file is licensed under CC4-BY-NC-SA international license.›;  ( l )  To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/›;    =    Author: Jean-Marc "jihem" QUERE 2016 - jean-marc.quere@codyssea.com››DEFINE TPointSize="4"›DEFINE _TrigCRads="63"››TYPE TPoint=[INT x INT y]›INT ARRAY _TrigTable(180)››PROC MTH()› TPoint POINTER Point› INT cx,cy,d,a=[0],r=[_TrigCRads]› cx=r› cy=0› d=1-r› DO›  Point=_TrigTable+(a*TPointSize)›  Point.x=cx›  Point.y=cy›  a==+1›  cy==+1›  IF d<0 THEN›   d==+2*cy+1›  ELSE›   cx==-1›   d==+2*(cy-cx)+1›  FI› UNTIL cx<cy        › OD›RETURN››CARD FUNC _TrigTableAt(INT a)› TPoint POINTER Point› TPoint p› a=a MOD 360› IF a>=45 and a<90 THEN›  a=89-a›  Point=_TrigTable+(a*TPointSize)›  P.x=Point.y›  P.y=Point.x› ELSEIF a>=90 and a<135 THEN›  a=a-90›  Point=_TrigTable+(a*TPointSize)›  P.x=-Point.y›  P.y=Point.x› ELSEIF a>=135 and a<180 THEN›  a=179-a›  Point=_TrigTable+(a*TPointSize)›  P.x=-Point.x›  P.y=Point.y› ELSEIF a>=180 and a<225 THEN›  a=a-180›  Point=_TrigTable+(a*TPointSize)›  P.x=-Point.x›  P.y=-Point.y› ELSEIF a>=225 and a<270 THEN›  a=269-a›  Point=_TrigTable+(a*TPointSize)›  P.x=-Point.y›  P.y=-Point.x› ELSEIF a>=270 and a<315 THEN›  a=a-270›  Point=_TrigTable+(a*TPointSize)›  P.x=Point.y›  P.y=-Point.x› ELSEIF a>=315 and a<360 THEN›  a=359-a›  Point=_TrigTable+(a*TPointSize)›  P.x=Point.x›  P.y=-Point.y› ELSE›  Point=_TrigTable+(a*TPointSize)›  P.x=Point.x›  P.y=Point.y› FI›RETURN (p)››;INT FUNC abs(INT i)›; IF i<0 THEN›;  i=-i›; FI›;RETURN (i)››INT FUNC abs=*(INT i)› [›  $E0 $80     ;     CPX #$80›  $90 $0F     ;     BCC <PC+$0F> ›  $18         ;     CLC›  $49 $FF     ;     EOR #$FF›  $69 $01     ;     ADC #$01›  $85 $A0     ;     STA $A0›  $8A         ;     TXA›  $49 $FF     ;     EOR #$FF›  $69 $00     ;     ADC #$00    ›  $85 $A1     ;     STA $A1  ›  $60         ;     RTS›  $85 $A0     ;     STA $A0›  $86 $A1     ;     STX $A1 ›  $60         ;     RTS› ]››INT FUNC cos(INT a,INT v)› TPoint POINTER p› p=_TrigTableAt(a)› v=v*p.x/_TrigCRads›RETURN (v)››;INT FUNC max(INT i, INT j)›; INT r›; IF i>j THEN›;  r=i›; ELSE›;  r=j›; FI›;RETURN (r)››INT FUNC max=*(INT i,j)› [›  $85 $A0     ;     STA $A0›  $86 $A1     ;     STX $A1›  $E0 $80     ;     CPX #$80›  $90 $12     ;     BCC PX›  $A5 $A3     ;     LDA $A3›  $C9 $80     ;     CMP #$80›  $90 $1E     ;     BCC OKB  ; (NP)›  $E4 $A3     ;     CPX $A3  ; (NN)›  $B0 $1A     ;     BCS OKB›  $D0 $05     ;     BNE OKA›  $98         ;     TYA ›  $C5 $A0     ;     CMP $A0›  $90 $13     ;     BCC OKB›  $60         ;     RTS      ; OKA›  $A5 $A3     ; PX  LDA $A3›  $C9 $80     ;     CMP #$80›  $B0 $0B     ;     BCS OKA  ; (PN)›  $E4 $A3     ;     CPX $A3  ; (PP)›  $90 $08     ;     BCC OKB›  $D0 $05     ;     BNE OKA›  $98         ;     TYA ›  $C5 $A0     ;     CMP $A0›  $B0 $01     ;     BCS OKB›  $60         ; OKA RTS ›  $84 $A0     ; OKB STY $A0›  $A5 $A3     ;     LDA $A3›  $85 $A1     ;     STA $A1›  $60         ;     RTS › ]››;INT FUNC min(INT i, INT j)›; INT r›; IF i<j THEN›;  r=i›; ELSE›;  r=j›; FI›;RETURN (r)››INT FUNC min=*(INT i,j)› [›  $85 $A0     ;     STA $A0›  $86 $A1     ;     STX $A1›  $E0 $80     ;     CPX #$80›  $90 $12     ;     BCC PX›  $A5 $A3     ;     LDA $A3›  $C9 $80     ;     CMP #$80›  $90 $0B     ;     BCC OKA  ; (NP)›  $E4 $A3     ;     CPX $A3  ; (NN)›  $90 $07     ;     BCC OKA›  $D0 $18     ;     BNE OKB›  $98         ;     TYA ›  $C5 $A0     ;     CMP $A0›  $90 $13     ;     BCC OKB›  $60         ;     RTS      ; OKA›  $A5 $A3     ; PX  LDA $A3›  $C9 $80     ;     CMP #$80›  $B0 $0C     ;     BCS OKB  ; (PN)›  $E4 $A3     ;     CPX $A3  ; (PP)›  $90 $07     ;     BCC OKA›  $D0 $06     ;     BNE OKB›  $98         ;     TYA ›  $C5 $A0     ;     CMP $A0›  $90 $01     ;     BCC OKB›  $60         ; OKA RTS ›  $84 $A0     ; OKB STY $A0›  $A5 $A3     ;     LDA $A3›  $85 $A1     ;     STA $A1›  $60         ;     RTS › ]››INT FUNC sin(INT a,INT v)› TPoint POINTER p› p=_TrigTableAt(a)› v=v*p.y/_TrigCRads›RETURN (v)››;INT FUNC sgn(INT i)›; IF i>0 THEN›;  i=1›; ELSEIF i<0 THEN›;  i=-1›; ELSE›;  i=0›; FI›;RETURN (i)››INT FUNC sgn=*(INT i)› [›  $E0 $80     ;     CPX #$80›  $90 $07     ;     BCC <PC+$07> ›  $A9 $FF     ;     LDA #$FF›  $85 $A0     ;     STA $A0›  $85 $A1     ;     STA $A1›  $60         ;     RTS     ›  $E0 $00     ;     CPX #$00›  $D0 $0B     ;     BNE <PC+$0B>  ›  $C9 $00     ;     CMP #$00›  $D0 $07     ;     BNE <PC+$07>›  $A9 $00     ;     LDA #$00›  $85 $A0     ;     STA $A0›  $85 $A1     ;     STA $A1›  $60         ;     RTS     ›  $A9 $01     ;     LDA #$01›  $85 $A0     ;     STA $A0›  $A9 $00     ;     LDA #$00›  $85 $A1     ;     STA $A1›  $60         ;     RTS     › ]››CARD FUNC rot(INT a,CARD c)› TPoint r› TPoint POINTER p› INT cx,cy,rx,ry› p=c› cx=p.x› cy=p.y› rx=cos(a,cx)› rx==-sin(a,cy)› ry=cos(a,cy)› ry==+sin(a,cx)› r.x=rx› r.y=ry›RETURN (r)››MODULE›